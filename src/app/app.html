<div *ngIf="settings$ | async as settings">
  <div
    *ngIf="weatherData$ | async as weather"
    class="background-container"
    [style.backgroundImage]="'url(' + getBackgroundImage(weather.list[0].weather[0].main) + ')'">
    <!-- Здесь будет фон, меняющийся в зависимости от погоды -->
  </div>

  <div class="dashboard-wrapper" *ngIf="weatherData$ | async as weather; else loading">
    <header>
      <button class="settings-btn" (click)="isSettingsOpen = true">⚙️</button>
      <h1>Погодный дашборд</h1>

      <div class="search-container">
        <input
          class="search-box"
          placeholder="Найти город..."
          [(ngModel)]="searchQuery"
          (input)="onSearchInput()"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()"
          autocomplete="off">

        <!-- Выпадающий список с результатами -->
        <div class="search-results" *ngIf="(searchResults$ | async) as results">
          <ul *ngIf="results.length > 0 && isSearchListVisible">
            <li *ngFor="let city of results" (click)="selectCity(city)">
              {{ city }}
            </li>
          </ul>
        </div>
      </div>
    </header>

    <main *ngIf="weather.list && weather.list.length > 0">
      <section class="current-weather-card">

        <h2>{{ weather.city.name }}, {{ weather.city.country }}</h2>
        <div class="main-info">
          <img [src]="'https://openweathermap.org/img/wn/' + weather.list[0].weather[0].icon + '@2x.png'" [alt]="weather.list[0].weather[0].description">
          <div class="temperature-details">
            <span class="temperature" [style.color]="getTempColor(weather.list[0].main.temp)">{{ weather.list[0].main.temp | temperature:settings.tempUnit | number:'1.0-0' }}°{{settings.tempUnit}}</span>
            <span class="feels-like">Ощущается как {{ weather.list[0].main.feels_like | temperature:settings.tempUnit | number:'1.0-0' }}°{{settings.tempUnit}}</span>
          </div>
        </div>

        <p class="condition-text">{{ weather.list[0].weather[0].description }}</p>

        <div class="details">
          <div>Влажность: {{ weather.list[0].main.humidity }}%</div>
          <div class="wind-details">
            Ветер:
            <div class="wind-direction" [style.transform]="'rotate(' + weather.list[0].wind.deg + 'deg)'">↑</div>
            {{ weather.list[0].wind.speed | wind:settings.windUnit | number:'1.0-1' }} {{ settings.windUnit === 'ms' ? 'м/с' : settings.windUnit === 'kmh' ? 'км/ч' : 'миль/ч' }}
          </div>
          <div class="pressure-details">
            <span>
              Давление:
              {{ weather.list[0].main.pressure | pressure:settings.pressureUnit | number:'1.0-0' }}
              {{ settings.pressureUnit === 'hPa' ? 'гПа' : 'мм рт.ст.' }}
            </span>
            <span class="pressure-hint" [ngClass]="getPressureHint(weather.list[0].main.pressure).className">
                {{ getPressureHint(weather.list[0].main.pressure).text }}
            </span>
          </div>
        </div>

          <div class="chart-container">
            <canvas #forecastChart></canvas>
          </div>
      </section>

          <!--
      <section class="forecast">
        <div class="forecast-container">
            <div class="day-card" *ngFor="let item of weather.list | slice:0:8">
              <p>{{ item.dt_txt | date:'HH:mm' }}</p>
              <img [src]="'https://openweathermap.org/img/wn/' + item.weather[0].icon + '.png'" [alt]="item.weather[0].description">
              <p class="temp" [style.color]="getTempColor(item.main.temp)">{{ item.main.temp | temperature:settings.tempUnit | number:'1.0-0' }}°</p>
            </div>
        </div>
      </section>
          -->
    </main>
  </div>

  <ng-template #loading>
    <div class="loader">
      Загрузка данных о погоде...
    </div>
  </ng-template>

  <app-settings-drawer
    [isOpen]="isSettingsOpen"
    [settings]="settings"
    (closeDrawer)="isSettingsOpen = false"
    (settingsChange)="onSettingsChange($event)">
  </app-settings-drawer>

</div>

<router-outlet></router-outlet>
